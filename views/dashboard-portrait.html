<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="refresh" content="300">
    <meta name="viewport" content="width=1264, initial-scale=1, maximum-scale=1, user-scalable=no">
    <style>
        /* 
           VIBE / NEO-BRUTALIST KINDLE THEME 
           Optimized for E-Ink (High Contrast, No Greys)
        */

        :root {
            --border-width: 5px;
            --shadow-offset: 8px;
            --gap: 24px;
            --font-main: "Helvetica Neue", "Amazon Ember", Arial, sans-serif;
            --font-display: "Arial Black", "Helvetica Neue Condensed Black", "Helvetica Neue", Arial, sans-serif;
            --font-mono: "Menlo", "SFMono-Regular", "Consolas", "Courier New", monospace;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-main);
            background: #ffffff;
            color: #000000;
            width: 1264px;
            height: 1570px;
            overflow: hidden;
            letter-spacing: -0.2px;
        }

        /* UTILS */
        .caps { text-transform: uppercase; }
        .bold { font-weight: 900; }
        .mono { font-family: var(--font-mono); }
        .flex { display: flex; }
        .col { flex-direction: column; }
        .center { align-items: center; justify-content: center; }
        .js-b { justify-content: space-between; }
        
        /* LAYOUT GRID */
        .layout {
            display: grid;
            grid-template-columns: 420px 1fr;
            grid-template-rows: auto 1fr;
            height: 100%;
        }

        /* HEADER (INVERTED) */
        .header {
            grid-column: 1 / -1;
            background: #000;
            color: #fff;
            padding: 20px 28px;
            border-bottom: var(--border-width) solid #000;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }
        
        .header-date {
            font-size: 48px;
            font-weight: 900;
            line-height: 0.95;
            letter-spacing: -2px;
            font-family: var(--font-display);
        }

        .header-time {
            font-size: 44px;
            font-weight: 900;
            line-height: 0.95;
            letter-spacing: -1px;
            font-family: var(--font-display);
            font-feature-settings: "tnum";
            font-variant-numeric: tabular-nums;
        }

        /* SIDEBAR */
        .sidebar {
            padding: 22px;
            border-right: var(--border-width) solid #000;
            display: flex;
            flex-direction: column;
            gap: 22px;
            background: #fff;
        }

        /* MAIN CONTENT */
        .main {
            padding: 22px;
            background: #fff;
            position: relative;
            /* Dotted background pattern for texture */
            background-image: radial-gradient(#000 10%, transparent 11%);
            background-size: 20px 20px;
        }
        /* White canvas for content to sit on top of dots if needed, 
           but 'event cards' will handle readability. 
           Let's make main bg white effectively by not seeing dots behind cards.
        */
        .main { background: #fff; } /* Reset to white for cleanliness */

        /* CARDS (Brutalist) */
        .card {
            border: var(--border-width) solid #000;
            padding: 0;
            margin-bottom: 12px;
            background: #fff;
            box-shadow: var(--shadow-offset) var(--shadow-offset) 0px #000;
            transition: transform 0.1s;
        }

        .card-header {
            background: #000;
            color: #fff;
            padding: 8px 14px;
            font-size: 20px;
            font-weight: 900;
            text-transform: uppercase;
            border-bottom: var(--border-width) solid #000;
            display: flex;
            justify-content: space-between;
            font-family: var(--font-display);
        }

        .card-body {
            padding: 16px;
        }

        /* WEATHER WIDGET */
        .weather-hero {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .weather-icon { 
            font-size: 88px; 
            line-height: 1; 
            margin: 2px 0; 
        }
        
        .weather-temp { 
            font-size: 76px; 
            font-weight: 900; 
            line-height: 0.8; 
            letter-spacing: -3px;
            margin-bottom: 4px;
            font-family: var(--font-display);
        }

        .weather-loc {
            background: #000;
            color: #fff;
            font-size: 15px;
            font-weight: 900;
            padding: 3px 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .weather-stats {
            display: flex;
            width: 100%;
            border-top: 4px solid #000;
            padding-top: 10px;
        }
        
        .stat-box {
            flex: 1;
            text-align: center;
        }
        
        .stat-val { font-size: 22px; font-weight: 900; display: block; font-family: var(--font-display); }
        .stat-label { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }

        /* TASK LIST */
        .task-list {
            display: flex;
            flex-direction: column;
            gap: 0;
        }
        
        .task-row {
            display: flex;
            align-items: flex-start;
            padding: 10px 0;
            border-bottom: 3px dashed #000;
        }
        .task-row:last-child { border-bottom: none; }
        
        .checkbox {
            width: 24px;
            height: 24px;
            border: 4px solid #000;
            margin-right: 12px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 900;
            box-shadow: 3px 3px 0 #000;
            background: #fff;
        }
        
        .task-text {
            font-size: 16px;
            font-weight: 700;
            line-height: 1.2;
            text-transform: uppercase;
        }
        
        .task-done { text-decoration: line-through; opacity: 0.4; }

        /* GITHUB CONTRIBUTIONS */
        .contrib-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr); /* 5 weeks */
            gap: 4px;
            margin-top: 6px;
        }

        .contrib-cell {
            width: 100%;
            padding-top: 100%;
            border: 2px solid #000;
            background: #fff;
        }

        .contrib-0 { background: #fff; }
        .contrib-1 { background: #d9d9d9; }
        .contrib-2 { background: #8c8c8c; }
        .contrib-3 { background: #000; }

        .contrib-legend {
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .contrib-legend .contrib-cell {
            width: 10px;
            height: 10px;
            padding-top: 0;
        }

        /* AGENDA */
        .stream-header {
            font-size: 38px;
            font-weight: 900;
            text-transform: uppercase;
            border-bottom: 8px solid #000;
            margin-bottom: 20px;
            padding-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            font-family: var(--font-display);
        }
        
        .stream-label { letter-spacing: -2px; }
        .stream-count { font-size: 16px; background: #000; color: #fff; padding: 4px 10px; border-radius: 20px; vertical-align: middle; }

        .agenda-row {
            display: grid;
            grid-template-columns: 120px 1fr;
            border: var(--border-width) solid #000;
            background: #fff;
            margin-bottom: 14px;
            box-shadow: 8px 8px 0px #000;
            min-height: 80px;
        }

        .agenda-time {
            background: #000;
            color: #fff;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 10px;
            border-right: var(--border-width) solid #000;
        }

        .agenda-time-start { font-size: 24px; font-weight: 900; letter-spacing: -1px; }
        .agenda-time-ampm { font-size: 12px; font-weight: 700; margin-top: -4px; }
        .agenda-time-dur { 
            margin-top: 8px; 
            font-size: 11px; 
            font-weight: 700; 
            background: #fff; 
            color: #000; 
            padding: 2px 6px;
        }

        .agenda-content {
            padding: 14px 16px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .agenda-title {
            font-size: 22px;
            font-weight: 900;
            line-height: 1.1;
            text-transform: uppercase;
            letter-spacing: -1px;
            margin-bottom: 6px;
        }

        .agenda-meta {
            display: flex;
            gap: 10px;
        }
        
        .tag {
            border: 3px solid #000;
            padding: 4px 10px;
            font-size: 12px;
            font-weight: 800;
            text-transform: uppercase;
            box-shadow: 3px 3px 0 #000;
        }
        
        .tag-mtg { background: #fff; }
        .tag-work { background: #000; color: #fff; }
        .tag-personal { background: #fff; border-style: dashed; }

        /* REFRESH */
        .refresh-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #fff;
            color: #000;
            border: 5px solid #000;
            padding: 10px 20px;
            font-size: 18px;
            font-weight: 900;
            text-transform: uppercase;
            box-shadow: 8px 8px 0 #000;
            z-index: 999;
            cursor: pointer;
        }
        .refresh-btn:active {
            transform: translate(4px, 4px);
            box-shadow: 4px 4px 0 #000;
        }

        /* EMPTY STATE */
        .empty-stream {
            border: 6px dashed #ccc;
            padding: 60px;
            text-align: center;
            font-size: 30px;
            font-weight: 900;
            color: #ccc;
            text-transform: uppercase;
        }

    </style>
</head>
<body>

    <div class="refresh-btn" onclick="window.location.reload()">
        REFRESH
    </div>

    <div class="layout">
        <!-- HEADER -->
        <div class="header">
            <div class="header-date" id="date">LOADING</div>
            <div class="header-time" id="time">--:--</div>
        </div>

        <!-- SIDEBAR -->
        <div class="sidebar">
            <!-- WEATHER -->
            <div class="card">
                <div class="card-header">
                    <span>LIVE</span>
                    <span>GUR</span>
                </div>
                <div class="card-body weather-hero">
                    <div class="weather-icon" id="w-icon">‚òÄÔ∏è</div>
                    <div class="weather-temp" id="w-temp">--¬∞</div>
                    <div class="weather-loc">GURUGRAM</div>
                    
                    <div class="weather-stats">
                        <div class="stat-box">
                            <span class="stat-label">FEELS LIKE</span>
                            <span class="stat-val" id="w-feels">--¬∞</span>
                        </div>
                        <div class="stat-box" style="border-left: 3px solid #000">
                            <span class="stat-label">HUMIDITY</span>
                            <span class="stat-val" id="w-humid">--%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TASKS -->
            <div class="card">
                <div class="card-header">
                    <span>TASKS</span>
                    <span id="task-count">0</span>
                </div>
                <div class="card-body">
                    <div class="task-list" id="todo-list">
                        <!-- Items -->
                    </div>
                </div>
            </div>

            <!-- GITHUB CONTRIBUTIONS -->
            <div class="card">
                <div class="card-header">
                    <span>GITHUB</span>
                    <span class="mono">5W</span>
                </div>
                <div class="card-body">
                    <div class="contrib-grid" id="contrib-grid"></div>
                    <div class="contrib-legend">
                        <span>LOW</span>
                        <div class="contrib-cell contrib-0"></div>
                        <div class="contrib-cell contrib-1"></div>
                        <div class="contrib-cell contrib-2"></div>
                        <div class="contrib-cell contrib-3"></div>
                        <span>HIGH</span>
                    </div>
                </div>
            </div>
            
            <div style="margin-top:auto; font-weight:900; text-align:center; opacity:0.3; font-size:14px;">
                SYSTEM ONLINE ‚Ä¢ v2.0
            </div>
        </div>

        <!-- MAIN -->
        <div class="main">
            <div class="stream-header">
                <span class="stream-label">AGENDA ‚Ä¢ NEXT 4H</span>
                <span class="stream-count" id="agenda-count">0</span>
            </div>
            
            <div id="stream-container">
                <!-- Agenda Items -->
            </div>
            
            <div id="empty-stream" class="empty-stream" style="display:none">
                CLEAR WINDOW
            </div>
        </div>
    </div>

<script>
    const API_BASE = 'http://192.168.1.140:5001';

    function init() {
        updateTime();
        setInterval(updateTime, 1000);
        
        fetchData();
        renderContrib();
        setInterval(fetchData, 300000);
    }

    function updateTime() {
        const now = new Date();
        const days = ['SUNDAY', 'MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY', 'SATURDAY'];
        const months = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
        
        document.getElementById('date').innerText = `${days[now.getDay()]} ${now.getDate()} ${months[now.getMonth()]}`;
        
        let h = now.getHours();
        let m = now.getMinutes();
        const ampm = h >= 12 ? 'PM' : 'AM';
        const h12 = h % 12 || 12;
        const mStr = m < 10 ? '0'+m : m;
        
        document.getElementById('time').textContent = `${h12}:${mStr} ${ampm}`;
    }

    async function fetchData() {
        try {
            const [wRes, cRes, tRes] = await Promise.all([
                fetch(`${API_BASE}/api/weather`),
                fetch(`${API_BASE}/api/calendar`),
                fetch(`${API_BASE}/api/todos`)
            ]);
            
            renderWeather(await wRes.json());
            renderCalendar(await cRes.json());
            renderTodos(await tRes.json());
        } catch(e) {
            console.error(e);
        }
    }

    function renderWeather(data) {
        const icons = { 0: '‚òÄÔ∏è', 1: 'üå§Ô∏è', 2: '‚òÅÔ∏è', 3: '‚òÅÔ∏è', 45: 'üå´Ô∏è', 51: 'üåßÔ∏è', 61: 'üåßÔ∏è', 80: 'üåßÔ∏è', 95: '‚õàÔ∏è' };
        document.getElementById('w-temp').innerText = Math.round(data.temp) + '¬∞';
        document.getElementById('w-feels').innerText = Math.round(data.feelsLike) + '¬∞';
        document.getElementById('w-humid').innerText = data.humidity + '%';
        document.getElementById('w-icon').innerText = icons[data.condition] || '‚òÄÔ∏è';
    }

    function renderTodos(data) {
        const list = document.getElementById('todo-list');
        list.innerHTML = '';
        
        const open = data.filter(t => !t.completed).length;
        document.getElementById('task-count').innerText = open;

        data.slice(0, 4).forEach(t => {
            list.innerHTML += `
                <div class="task-row ${t.completed ? 'task-done' : ''}">
                    <div class="checkbox">${t.completed ? '‚úì' : ''}</div>
                    <div class="task-text">${t.text}</div>
                </div>
            `;
        });
    }

    function renderContrib() {
        const grid = document.getElementById('contrib-grid');
        if (!grid) return;
        grid.innerHTML = '';

        const base = new Date().getDate();
        for (let i = 0; i < 35; i++) {
            const level = (base + i * 2) % 4;
            const cell = document.createElement('div');
            cell.className = `contrib-cell contrib-${level}`;
            grid.appendChild(cell);
        }
    }

    function renderCalendar(data) {
        const list = document.getElementById('stream-container');
        list.innerHTML = '';

        const now = new Date();
        const windowEnd = new Date(now.getTime() + 4 * 60 * 60 * 1000);

        const events = (data.events || [])
            .filter(e => new Date(e.end) > now && new Date(e.start) < windowEnd)
            .sort((a, b) => new Date(a.start) - new Date(b.start));

        const countEl = document.getElementById('agenda-count');
        if (countEl) countEl.textContent = events.length;

        if (events.length === 0) {
            document.getElementById('empty-stream').style.display = 'block';
            return;
        }
        document.getElementById('empty-stream').style.display = 'none';

        events.slice(0, 6).forEach(e => {
            const start = new Date(e.start);
            const end = new Date(e.end);

            let h = start.getHours();
            let m = start.getMinutes();
            const ampm = h >= 12 ? 'PM' : 'AM';
            const h12 = h % 12 || 12;
            const mStr = m < 10 ? '0' + m : m;

            const duration = Math.round((end - start) / 60000);

            let tagClass = 'tag-mtg';
            if (e.type === 'work') tagClass = 'tag-work';
            if (e.type === 'personal') tagClass = 'tag-personal';

            list.innerHTML += `
                <div class="agenda-row">
                    <div class="agenda-time">
                        <div class="agenda-time-start">${h12}:${mStr}</div>
                        <div class="agenda-time-ampm">${ampm}</div>
                        <div class="agenda-time-dur">${duration}m</div>
                    </div>
                    <div class="agenda-content">
                        <div class="agenda-title">${e.title}</div>
                        <div class="agenda-meta">
                            <span class="tag ${tagClass}">${e.type || 'EVENT'}</span>
                        </div>
                    </div>
                </div>
            `;
        });
    }

    init();
</script>
</body>
</html>